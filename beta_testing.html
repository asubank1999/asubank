<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASU Student Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #0a192f 0%, #172a45 100%);
            min-height: 100vh;
            direction: rtl;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            padding: 15px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 700;
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .offline-indicator {
            width: 10px;
            height: 10px;
            background: #6b7280;
            border-radius: 50%;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Auth Forms */
        .auth-container {
            background: rgba(15, 23, 42, 0.9);
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            margin: 50px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: rgba(30, 58, 138, 0.3);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
            color: #fff;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e5e7eb;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            transition: border 0.3s;
            color: #fff;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            padding: 14px 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
        }

        .btn-secondary {
            background: #4b5563;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #374151;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(15, 23, 42, 0.8);
            padding: 10px;
            border-radius: 10px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: rgba(30, 58, 138, 0.3);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            color: #fff;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        .nav-tab i {
            margin-left: 8px;
        }

        /* Views */
        .view {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3) 0%, rgba(37, 99, 235, 0.2) 100%);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .stat-card h3 {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: #3b82f6;
        }

        /* Online Users */
        .online-users {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .online-users h2 {
            margin-bottom: 15px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .user-item:hover {
            background: rgba(30, 41, 59, 0.9);
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Forum */
        .forums-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .forum-card {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(59, 130, 246, 0.2);
            color: #fff;
        }

        .forum-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(37, 99, 235, 0.3);
            border-color: #3b82f6;
        }

        .forum-icon {
            font-size: 40px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .forum-card h3 {
            color: #fff;
            margin-bottom: 10px;
        }

        .forum-card p {
            color: #9ca3af;
            font-size: 14px;
        }

        /* Subforum Creation */
        .subforum-create {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        /* Forum Detail */
        .forum-detail {
            display: none;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(59, 130, 246, 0.2);
            color: #fff;
        }

        .forum-detail.active {
            display: block;
        }

        .back-btn {
            background: #4b5563;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-family: 'Cairo', sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .post-form {
            background: rgba(30, 41, 59, 0.6);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .post-form textarea {
            width: 100%;
            padding: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            min-height: 100px;
            margin-bottom: 10px;
            color: #fff;
        }

        .file-upload {
            margin-bottom: 10px;
            color: #e5e7eb;
        }

        .posts-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .post-item {
            background: rgba(30, 41, 59, 0.6);
            padding: 20px;
            border-radius: 8px;
            border-right: 4px solid #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #9ca3af;
            font-size: 14px;
        }

        .post-content {
            color: #e5e7eb;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .post-attachment {
            margin-top: 10px;
            padding: 10px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Courses Management */
        .courses-management {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .course-card {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3) 0%, rgba(37, 99, 235, 0.2) 100%);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .course-header {
            padding: 20px;
            color: white;
            font-weight: 600;
        }

        .course-header.math {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .course-header.physics {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .course-header.chemistry {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
        }

        .course-body {
            padding: 20px;
        }

        .course-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Chat System */
        .chat-container {
            display: flex;
            gap: 20px;
            height: 500px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .chat-users {
            width: 300px;
            background: rgba(30, 41, 59, 0.6);
            padding: 20px;
            overflow-y: auto;
        }

        .chat-messages {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .message-input {
            display: flex;
            gap: 10px;
        }

        /* Profile */
        .profile-container {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.9) 100%);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: 600;
        }

        /* Admin Panel */
        .admin-panel {
            background: rgba(15, 23, 42, 0.9);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .admin-users-list {
            max-height: 400px;
            overflow-y: auto;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #9ca3af;
        }

        .error {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .success {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .warning {
            background: rgba(234, 179, 8, 0.2);
            color: #fde047;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        /* Guest Timer */
        .guest-timer {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid,
            .forums-grid,
            .courses-grid {
                grid-template-columns: 1fr;
            }
            
            .chat-container {
                flex-direction: column;
                height: 600px;
            }
            
            .chat-users {
                width: 100%;
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div id="authPage" class="auth-container">
        <div class="logo" style="justify-content: center; margin-bottom: 30px;">
            <span>ğŸ“</span>
            <span>Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ©</span>
        </div>

        <div id="guestTimer" class="guest-timer hidden">
            <i class="fas fa-clock"></i>
            <span id="timerDisplay">60 Ø«Ø§Ù†ÙŠØ©</span>
        </div>

        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchTab('signin')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <button class="auth-tab" onclick="switchTab('signup')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
            <button class="auth-tab" onclick="switchTab('guest')">Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø±</button>
        </div>

        <div id="errorMsg" class="error hidden"></div>
        <div id="successMsg" class="success hidden"></div>

        <!-- Sign In Form -->
        <form id="signinForm" class="auth-form">
            <div class="form-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="signin_email" required>
            </div>
            <div class="form-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="signin_password" required>
            </div>
            <button type="submit" class="btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </form>

        <!-- Sign Up Form -->
        <form id="signupForm" class="auth-form hidden">
            <div class="form-group">
                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                <input type="text" id="signup_name" required>
            </div>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±ÙŠØ¯ (Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·)</label>
                <input type="text" id="signup_username" required pattern="[a-zA-Z0-9_]+" 
                       title="ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·">
                <small style="color: #9ca3af; font-size: 12px;">Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ ÙÙŠ Ø±Ø§Ø¨Ø· Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ: example.com/user/Ø§Ø³Ù…Ùƒ</small>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="signup_email" required>
            </div>
            <div class="form-group">
                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input type="tel" id="signup_phone" required>
            </div>
            <div class="form-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="signup_password" required>
            </div>
            <button type="submit" class="btn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        </form>

        <!-- Guest Form -->
        <form id="guestForm" class="auth-form hidden">
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø§Ø¦Ø±</label>
                <input type="text" id="guest_name" required>
            </div>
            <div class="warning">
                <i class="fas fa-exclamation-triangle"></i>
                Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 60 Ø«Ø§Ù†ÙŠØ©
            </div>
            <button type="submit" class="btn">Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø±</button>
        </form>
    </div>

    <div id="mainApp" class="container hidden">
        <div class="header">
            <div class="logo">
                <span>ğŸ“</span>
                <span>ASU Portal</span>
            </div>
            <div class="user-info">
                <div id="userStatusIndicator" class="online-indicator"></div>
                <span id="userName">Ù…Ø³ØªØ®Ø¯Ù…</span>
                <button class="btn" onclick="openProfileModal()" style="padding: 8px 20px;">
                    <i class="fas fa-user"></i> Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                </button>
                <button class="btn btn-secondary" onclick="logout()" style="padding: 8px 20px;">
                    <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchView('dashboard')">
                <i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
            <button class="nav-tab" onclick="switchView('courses')">
                <i class="fas fa-book"></i> Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
            </button>
            <button class="nav-tab" onclick="switchView('forums')">
                <i class="fas fa-comments"></i> Ø§Ù„Ù…Ù†ØªØ¯ÙŠØ§Øª
            </button>
            <button class="nav-tab" onclick="switchView('chat')">
                <i class="fas fa-comment-dots"></i> Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
            </button>
            <button id="adminTab" class="nav-tab hidden" onclick="switchView('admin')">
                <i class="fas fa-shield-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            </button>
        </div>

        <!-- Dashboard View -->
        <div id="dashboardView" class="view active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
                    <div class="value" id="coursesCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†</h3>
                    <div class="value" id="onlineCount">1</div>
                </div>
                <div class="stat-card">
                    <h3>Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                    <div class="value" id="postsToday">0</div>
                </div>
                <div class="stat-card">
                    <h3>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                    <div class="value" id="activeChats">0</div>
                </div>
            </div>

            <div class="online-users">
                <h2><i class="fas fa-users"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù†</h2>
                <div class="user-list" id="onlineUsersList">
                    <div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                </div>
            </div>
        </div>

        <!-- Courses View -->
        <div id="coursesView" class="view">
            <div class="courses-management">
                <h2 style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                    <span><i class="fas fa-book"></i> Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</span>
                    <button class="btn btn-success" onclick="openAddCourseModal()">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </button>
                </h2>
                
                <div class="courses-grid" id="userCoursesList">
                    <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯...</div>
                </div>
            </div>
        </div>

        <!-- Forums View -->
        <div id="forumsView" class="view">
            <div class="subforum-create" id="subforumCreateSection">
                <h3><i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¯Ù‰ ÙØ±Ø¹ÙŠ Ø¬Ø¯ÙŠØ¯</h3>
                <form id="createSubforumForm" style="margin-top: 15px;">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¯Ù‰ Ø§Ù„ÙØ±Ø¹ÙŠ</label>
                        <input type="text" id="subforumName" required>
                    </div>
                    <div class="form-group">
                        <label>ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¯Ù‰</label>
                        <textarea id="subforumDescription" rows="2" required></textarea>
                    </div>
                    <button type="submit" class="btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¯Ù‰</button>
                </form>
            </div>

            <h2 style="margin-bottom: 15px; color: white;">Ø§Ù„Ù…Ù†ØªØ¯ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
            <div class="forums-grid" id="mainForumsList">
                <!-- Main forums will be loaded here -->
            </div>

            <h2 style="margin-bottom: 15px; color: white; margin-top: 30px;">Ø§Ù„Ù…Ù†ØªØ¯ÙŠØ§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©</h2>
            <div class="forums-grid" id="subforumsList">
                <!-- Subforums will be loaded here -->
            </div>
        </div>

        <!-- Chat View -->
        <div id="chatView" class="view">
            <div class="chat-container">
                <div class="chat-users">
                    <h3 style="margin-bottom: 15px; color: white;">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØ§Ø­ÙˆÙ† Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
                    <div id="chatUsersList" class="user-list">
                        <div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                </div>
                <div class="chat-messages">
                    <div id="selectedChatUser" style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(59, 130, 246, 0.2);">
                        <div class="loading">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</div>
                    </div>
                    <div id="messagesContainer" class="messages-container">
                        <div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ù†Ø´Ø·Ø©</div>
                    </div>
                    <div class="message-input">
                        <input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." style="flex: 1;" disabled>
                        <button class="btn" id="sendMessageBtn" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin View -->
        <div id="adminView" class="view">
            <div class="admin-panel">
                <h2 style="margin-bottom: 20px; color: white;"><i class="fas fa-shield-alt"></i> Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
                
                <div class="admin-users-list">
                    <h3>Ø·Ù„Ø¨Ø§Øª ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h3>
                    <div id="pendingChatRequests">
                        <div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                    
                    <h3 style="margin-top: 30px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                    <div id="allUsersList">
                        <div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Forum Detail View -->
        <div id="forumDetailView" class="forum-detail">
            <button class="back-btn" onclick="closeForum()">
                <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
            </button>
            <h2 id="forumTitle" style="margin-bottom: 20px;"></h2>
            
            <div class="post-form">
                <h3 style="margin-bottom: 15px;"><i class="fas fa-edit"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <form id="newPostForm">
                    <textarea id="postContent" placeholder="Ø§ÙƒØªØ¨ Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ù‡Ù†Ø§..." required></textarea>
                    <div class="file-upload">
                        <label>Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                        <input type="file" id="postAttachment" accept="image/*,.pdf,.doc,.docx">
                        <small style="color: #9ca3af; font-size: 12px;">ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ù…Ù„ÙØ§Øª PDF</small>
                    </div>
                    <button type="submit" class="btn"><i class="fas fa-paper-plane"></i> Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</button>
                </form>
            </div>

            <h3 style="margin-bottom: 15px;"><i class="fas fa-comments"></i> Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</h3>
            <div class="posts-list" id="postsList">
                <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª...</div>
            </div>
        </div>

        <!-- Profile View -->
        <div id="profileView" class="view">
            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">Ù…</div>
                    <div>
                        <h2 id="profileName">Ø§Ù„Ø§Ø³Ù…</h2>
                        <p id="profileUsername" style="color: #9ca3af;">@username</p>
                        <p id="profileStatus" style="color: #4ade80;"><i class="fas fa-circle"></i> Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</p>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
                        <div class="value" id="profileJoinDate">2024</div>
                    </div>
                    <div class="stat-card">
                        <h3>Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±</h3>
                        <div class="value" id="profileLastSeen">Ø§Ù„Ø¢Ù†</div>
                    </div>
                    <div class="stat-card">
                        <h3>Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</h3>
                        <div class="value" id="profilePosts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Ø§Ù„Ø¯ÙˆØ±Ø§Øª</h3>
                        <div class="value" id="profileCourses">0</div>
                    </div>
                </div>

                <h3 style="margin: 30px 0 15px 0;"><i class="fas fa-book"></i> Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
                <div class="courses-grid" id="profileCoursesList">
                    <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="addCourseModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <form id="addCourseForm">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="courseName" required>
                </div>
                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="courseCode" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                    <select id="courseSemester" required style="width: 100%; padding: 12px; background: rgba(30, 41, 59, 0.8); border: 2px solid rgba(59, 130, 246, 0.2); border-radius: 8px; color: #fff;">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„</option>
                        <option value="Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„ 2024-2025">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„ 2024-2025</option>
                        <option value="Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ 2024-2025">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ 2024-2025</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</label>
                    <input type="range" id="courseProgress" min="0" max="100" value="0" style="width: 100%;">
                    <span id="progressValue">0%</span>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn" style="flex: 1;">Ø¥Ø¶Ø§ÙØ©</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addCourseModal')" style="flex: 1;">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editCourseModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;"><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø§Ø¯Ø©</h2>
            <form id="editCourseForm">
                <input type="hidden" id="editCourseId">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="editCourseName" required>
                </div>
                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="editCourseCode" required>
                </div>
                <div class="form-group">
                    <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</label>
                    <input type="range" id="editCourseProgress" min="0" max="100" value="0" style="width: 100%;">
                    <span id="editProgressValue">0%</span>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn" style="flex: 1;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                    <button type="button" class="btn btn-danger" onclick="deleteCourse()" style="flex: 1;">Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø©</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editCourseModal')" style="flex: 1;">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2><i class="fas fa-user-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
                <button onclick="closeModal('profileModal')" style="background: none; border: none; color: #fff; cursor: pointer; font-size: 20px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-group">
                <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„ÙØ±ÙŠØ¯</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="background: rgba(30, 41, 59, 0.8); padding: 8px 12px; border-radius: 6px; flex: 1;">
                        https://myexamplewebsite.com/user/<span id="profileLinkPreview">username</span>
                    </span>
                    <button type="button" class="btn" onclick="copyProfileLink()">
                        <i class="fas fa-copy"></i> Ù†Ø³Ø®
                    </button>
                </div>
                <small style="color: #9ca3af;">Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ ØªØ¹ÙŠÙŠÙ†Ù‡</small>
            </div>
            
            <div class="form-group">
                <label>Ù†Ø¨Ø°Ø© Ø¹Ù†ÙŠ</label>
                <textarea id="profileBio" rows="3" style="width: 100%; padding: 12px; background: rgba(30, 41, 59, 0.8); border: 2px solid rgba(59, 130, 246, 0.2); border-radius: 8px; color: #fff;"></textarea>
            </div>
            
            <button type="button" class="btn" style="width: 100%; margin-top: 20px;" onclick="updateProfile()">
                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
            </button>
        </div>
    </div>

    <script>
        // Configuration
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbztq9Yd66mA8cce8VT9NKWpHdry7UBxPBg0qpjp2--sh7JyqXENgn7hHEslKCd5ffEA/exec';
        let currentUser = null;
        let currentForum = null;
        let onlineUsers = [];
        let userCourses = [];
        let chatUsers = [];
        let selectedChatUser = null;
        let guestTimer = null;
        let timeLeft = 60;
        let systemInitialized = false;

        // Initialize system
        async function checkSystemStatus() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getSystemStatus');
                const data = await response.json();
                
                if (data.success && data.initialized) {
                    systemInitialized = true;
                    console.log('âœ“ System initialized');
                }
            } catch (error) {
                console.log('Running in demo mode');
            }
        }

        // Auth Tab Switching
        function switchTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.add('hidden'));
            
            event.target.classList.add('active');
            
            if (tab === 'signin') {
                document.getElementById('signinForm').classList.remove('hidden');
            } else if (tab === 'signup') {
                document.getElementById('signupForm').classList.remove('hidden');
            } else if (tab === 'guest') {
                document.getElementById('guestForm').classList.remove('hidden');
            }
        }

        // View Switching
        function switchView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(viewId + 'View').classList.add('active');
            event.target.classList.add('active');
            
            if (viewId === 'courses') {
                loadUserCourses();
            } else if (viewId === 'forums') {
                loadForums();
            } else if (viewId === 'chat') {
                loadChatUsers();
            } else if (viewId === 'admin') {
                loadAdminData();
            }
        }

        // Guest Timer
        function startGuestTimer() {
            const timerDisplay = document.getElementById('timerDisplay');
            const timerElement = document.getElementById('guestTimer');
            timerElement.classList.remove('hidden');
            timeLeft = 60;
            
            guestTimer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft + ' Ø«Ø§Ù†ÙŠØ©';
                
                if (timeLeft <= 10) {
                    timerElement.style.background = 'rgba(239, 68, 68, 0.9)';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(guestTimer);
                    showError('Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø²Ø§Ø¦Ø±. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.');
                    logout();
                }
            }, 1000);
        }

        // Show Messages
        function showError(msg) {
            const el = document.getElementById('errorMsg');
            el.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${msg}`;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 5000);
        }

        function showSuccess(msg) {
            const el = document.getElementById('successMsg');
            el.innerHTML = `<i class="fas fa-check-circle"></i> ${msg}`;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 5000);
        }

        // Sign Up
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signup_name').value;
            const username = document.getElementById('signup_username').value;
            const email = document.getElementById('signup_email').value;
            const phone = document.getElementById('signup_phone').value;
            const password = document.getElementById('signup_password').value;

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'signup',
                        name: name,
                        username: username,
                        email: email,
                        phone: phone,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccess('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                    setTimeout(() => {
                        switchTab('signin');
                        document.getElementById('signin_email').value = email;
                    }, 1500);
                } else {
                    showError(data.message || 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨');
                }
            } catch (error) {
                currentUser = { 
                    name: name, 
                    username: username,
                    email: email, 
                    phone: phone, 
                    type: 'student',
                    joinDate: new Date().toLocaleDateString('ar-SA')
                };
                showDashboard();
                showSuccess('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ (ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©)');
            }
        });

        // Sign In
        document.getElementById('signinForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('signin_email').value;
            const password = document.getElementById('signin_password').value;

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'signin',
                        email: email,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    showDashboard();
                    showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                    
                    // Check if user is admin
                    if (currentUser.type === 'admin') {
                        document.getElementById('adminTab').classList.remove('hidden');
                    }
                } else {
                    showError(data.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                }
            } catch (error) {
                currentUser = { 
                    name: email.split('@')[0], 
                    username: email.split('@')[0],
                    email: email, 
                    type: 'student',
                    joinDate: '2024-01-01'
                };
                showDashboard();
                showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©)');
            }
        });

        // Guest Login
        document.getElementById('guestForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('guest_name').value;
            const username = 'guest_' + Date.now();
            currentUser = { 
                name: name, 
                username: username,
                type: 'guest',
                joinDate: new Date().toLocaleDateString('ar-SA')
            };
            showDashboard();
            showSuccess('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙƒØ²Ø§Ø¦Ø±');
            startGuestTimer();
        });

        // Show Dashboard
        function showDashboard() {
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('profileLinkPreview').textContent = currentUser.username;
            
            // Update profile preview
            if (currentUser.type !== 'guest') {
                document.getElementById('profileName').textContent = currentUser.name;
                document.getElementById('profileUsername').textContent = '@' + currentUser.username;
                document.getElementById('profileJoinDate').textContent = currentUser.joinDate;
            }
            
            updateOnlineUsers();
            loadUserCourses();
            loadForums();
            
            // Update online status every 30 seconds
            setInterval(updateOnlineStatus, 30000);
            setInterval(updateOnlineUsers, 30000);
        }

        // Update Online Status
        async function updateOnlineStatus() {
            if (!currentUser || currentUser.type === 'guest') return;
            
            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'updateOnlineStatus',
                        userId: currentUser.id || currentUser.username,
                        userName: currentUser.name,
                        userType: currentUser.type
                    })
                });
            } catch (error) {
                console.log('Error updating online status');
            }
        }

        // Update Online Users
        async function updateOnlineUsers() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getOnlineUsers');
                const data = await response.json();
                onlineUsers = data.users || [];
            } catch (error) {
                onlineUsers = [
                    { name: currentUser.name, type: currentUser.type, lastSeen: new Date().toISOString() },
                    { name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', type: 'student', lastSeen: new Date().toISOString() },
                    { name: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ', type: 'student', lastSeen: new Date().toISOString() }
                ];
            }
            
            displayOnlineUsers();
        }

        function displayOnlineUsers() {
            const list = document.getElementById('onlineUsersList');
            document.getElementById('onlineCount').textContent = onlineUsers.length;
            
            list.innerHTML = onlineUsers.map(user => {
                const isOnline = new Date(user.lastSeen) > new Date(Date.now() - 5 * 60 * 1000);
                const statusText = isOnline ? 'Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†' : 'ØºÙŠØ± Ù…ØªØµÙ„';
                const statusColor = isOnline ? '#4ade80' : '#9ca3af';
                const statusIcon = isOnline ? 'fa-circle' : 'fa-circle';
                
                return `
                    <div class="user-item" onclick="viewUserProfile('${user.id || user.name}')">
                        <div class="user-avatar">${user.name.charAt(0)}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #fff;">${user.name}</div>
                            <div style="font-size: 12px; color: ${statusColor};">
                                <i class="fas ${statusIcon}"></i> ${statusText}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load User Courses
        async function loadUserCourses() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getUserCourses&userId=' + (currentUser.id || currentUser.username));
                const data = await response.json();
                userCourses = data.courses || [];
            } catch (error) {
                userCourses = [
                    { id: 1, name: 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', code: 'MATH101', semester: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„ 2024-2025', progress: 64 },
                    { id: 2, name: 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', code: 'PHY101', semester: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„ 2024-2025', progress: 62 },
                    { id: 3, name: 'Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠØ©', code: 'LEAD101', semester: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„ 2024-2025', progress: 68 }
                ];
            }
            
            displayUserCourses();
        }

        function displayUserCourses() {
            const list = document.getElementById('userCoursesList');
            document.getElementById('coursesCount').textContent = userCourses.length;
            
            if (userCourses.length === 0) {
                list.innerHTML = '<div class="loading">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…ÙˆØ§Ø¯ Ø¨Ø¹Ø¯</div>';
                return;
            }
            
            list.innerHTML = userCourses.map(course => {
                const colors = ['math', 'physics', 'chemistry'];
                const colorClass = colors[course.id % 3];
                
                return `
                    <div class="course-card">
                        <div class="course-header ${colorClass}">
                            <h3>${course.name}</h3>
                            <p>${course.semester} - ${course.code}</p>
                        </div>
                        <div class="course-body">
                            <p>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: ${course.progress}%</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${course.progress}%"></div>
                            </div>
                            <div class="course-actions">
                                <button class="btn btn-secondary" onclick="editCourse(${course.id})" style="flex: 1;">
                                    <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                                </button>
                                <button class="btn btn-danger" onclick="deleteCourse(${course.id})" style="flex: 1;">
                                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Add Course
        document.getElementById('addCourseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const course = {
                name: document.getElementById('courseName').value,
                code: document.getElementById('courseCode').value,
                semester: document.getElementById('courseSemester').value,
                progress: document.getElementById('courseProgress').value
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'addCourse',
                        userId: currentUser.id || currentUser.username,
                        course: course
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeModal('addCourseModal');
                    loadUserCourses();
                    showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                }
            } catch (error) {
                course.id = userCourses.length + 1;
                userCourses.push(course);
                closeModal('addCourseModal');
                loadUserCourses();
                showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© (ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©)');
            }
        });

        // Edit Course
        function editCourse(courseId) {
            const course = userCourses.find(c => c.id === courseId);
            if (!course) return;
            
            document.getElementById('editCourseId').value = course.id;
            document.getElementById('editCourseName').value = course.name;
            document.getElementById('editCourseCode').value = course.code;
            document.getElementById('editCourseProgress').value = course.progress;
            document.getElementById('editProgressValue').textContent = course.progress + '%';
            
            openModal('editCourseModal');
        }

        document.getElementById('editCourseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const courseId = parseInt(document.getElementById('editCourseId').value);
            const course = {
                name: document.getElementById('editCourseName').value,
                code: document.getElementById('editCourseCode').value,
                progress: document.getElementById('editCourseProgress').value
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'updateCourse',
                        courseId: courseId,
                        course: course
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeModal('editCourseModal');
                    loadUserCourses();
                    showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                }
            } catch (error) {
                const index = userCourses.findIndex(c => c.id === courseId);
                if (index !== -1) {
                    userCourses[index] = { ...userCourses[index], ...course };
                }
                closeModal('editCourseModal');
                loadUserCourses();
                showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø§Ø¯Ø© (ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©)');
            }
        });

        // Delete Course
        function deleteCourse(courseId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ')) return;
            
            try {
                fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'deleteCourse',
                        courseId: courseId
                    })
                });
                
                userCourses = userCourses.filter(c => c.id !== courseId);
                loadUserCourses();
                showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
                closeModal('editCourseModal');
            } catch (error) {
                userCourses = userCourses.filter(c => c.id !== courseId);
                loadUserCourses();
                showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© (ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©)');
                closeModal('editCourseModal');
            }
        }

        // Load Forums
        async function loadForums() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getForums');
                const data = await response.json();
                displayForums(data.forums || [], data.subforums || []);
            } catch (error) {
                const mainForums = [
                    { id: 'helping', name: 'Ù…Ù†ØªØ¯Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø©', desc: 'Ù„Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ù†Ù‚Ø§Ø´Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø¹Ø§Ù…Ø©', icon: 'ğŸ’¬' },
                    { id: 'academic', name: 'Ø§Ù„Ù…Ù†ØªØ¯Ù‰ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ', desc: 'Ù„Ù„Ù†Ù‚Ø§Ø´Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ÙˆØ§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©', icon: 'ğŸ“š' },
                    { id: 'tech', name: 'Ø§Ù„Ù…Ù†ØªØ¯Ù‰ Ø§Ù„ØªÙ‚Ù†ÙŠ', desc: 'Ù„Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙˆØ§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©', icon: 'ğŸ’»' },
                    { id: 'social', name: 'Ø§Ù„Ù…Ù†ØªØ¯Ù‰ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ', desc: 'Ù„Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ©', icon: 'ğŸ‰' }
                ];
                
                const subforums = [
                    { id: 'gaming1', name: 'Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', desc: 'Ù…Ù†Ø§Ù‚Ø´Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©', parent: 'social', createdBy: 'Ø£Ø­Ù…Ø¯' },
                    { id: 'gaming2', name: 'ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨', desc: 'ØªØ¹Ù„Ù… ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ± Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨', parent: 'tech', createdBy: 'Ø³Ø§Ø±Ø©' }
                ];
                
                displayForums(mainForums, subforums);
            }
        }

        function displayForums(mainForums, subforums) {
            // Main forums
            const mainList = document.getElementById('mainForumsList');
            mainList.innerHTML = mainForums.map(forum => `
                <div class="forum-card" onclick="openForum('${forum.id}')">
                    <div class="forum-icon">${forum.icon}</div>
                    <h3>${forum.name}</h3>
                    <p>${forum.desc}</p>
                </div>
            `).join('');

            // Subforums
            const subList = document.getElementById('subforumsList');
            if (subforums.length === 0) {
                subList.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¯ÙŠØ§Øª ÙØ±Ø¹ÙŠØ©</div>';
            } else {
                subList.innerHTML = subforums.map(forum => `
                    <div class="forum-card" onclick="openForum('${forum.id}')">
                        <div class="forum-icon">ğŸ®</div>
                        <h3>${forum.name}</h3>
                        <p>${forum.desc}</p>
                        <small style="color: #9ca3af;">ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø©: ${forum.createdBy}</small>
                    </div>
                `).join('');
            }
        }

        // Create Subforum
        document.getElementById('createSubforumForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (currentUser.type === 'guest') {
                showError('Ø§Ù„Ø²ÙˆØ§Ø± Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¯ÙŠØ§Øª ÙØ±Ø¹ÙŠØ©');
                return;
            }
            
            const subforum = {
                name: document.getElementById('subforumName').value,
                description: document.getElementById('subforumDescription').value,
                createdBy: currentUser.name
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'createSubforum',
                        subforum: subforum
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('createSubforumForm').reset();
                    loadForums();
                    showSuccess('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¯Ù‰ Ø§Ù„ÙØ±Ø¹ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
                }
            } catch (error) {
                showSuccess('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¯Ù‰ Ø§Ù„ÙØ±Ø¹ÙŠ (ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©)');
                loadForums();
            }
        });

        // Open Forum
        function openForum(forumId) {
            currentForum = forumId;
            const forumTitles = {
                helping: 'Ù…Ù†ØªØ¯Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø©',
                academic: 'Ø§Ù„Ù…Ù†ØªØ¯Ù‰ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ',
                tech: 'Ø§Ù„Ù…Ù†ØªØ¯Ù‰ Ø§Ù„ØªÙ‚Ù†ÙŠ',
                social: 'Ø§Ù„Ù…Ù†ØªØ¯Ù‰ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ',
                gaming1: 'Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©',
                gaming2: 'ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨'
            };
            
            document.getElementById('forumTitle').textContent = forumTitles[forumId] || forumId;
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('forumDetailView').classList.add('active');
            loadPosts();
        }

        function closeForum() {
            document.getElementById('dashboardView').classList.add('active');
            document.getElementById('forumDetailView').classList.remove('active');
            currentForum = null;
            switchView('forums');
        }

        // Load Posts
        async function loadPosts() {
            const postsList = document.getElementById('postsList');
            postsList.innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª...</div>';
            
            try {
                const response = await fetch(SCRIPT_URL + `?action=getPosts&forum=${currentForum}`);
                const data = await response.json();
                displayPosts(data.posts || []);
            } catch (error) {
                const demoPosts = [
                    {
                        id: 1,
                        author: 'Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯',
                        content: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù‡Ù„ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØ³Ø§Ø¹Ø¯Ù†ÙŠ Ø£Ø­Ø¯ ÙÙŠ ÙÙ‡Ù… Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„ØªÙØ§Ø¶Ù„ ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„ØŸ',
                        timestamp: new Date().toLocaleString('ar-SA'),
                        attachment: null,
                        attachmentType: null
                    },
                    {
                        id: 2,
                        author: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ',
                        content: 'Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯! Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©. Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø°ÙŠ ØªØ¬Ø¯ ØµØ¹ÙˆØ¨Ø© ÙÙŠÙ‡ØŸ',
                        timestamp: new Date(Date.now() - 3600000).toLocaleString('ar-SA'),
                        attachment: 'https://example.com/file.pdf',
                        attachmentType: 'pdf'
                    }
                ];
                displayPosts(demoPosts);
            }
        }

        function displayPosts(posts) {
            const postsList = document.getElementById('postsList');
            
            if (posts.length === 0) {
                postsList.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ!</div>';
                return;
            }
            
            postsList.innerHTML = posts.map(post => {
                let attachmentHTML = '';
                if (post.attachment) {
                    if (post.attachmentType === 'pdf') {
                        attachmentHTML = `
                            <div class="post-attachment">
                                <i class="fas fa-file-pdf" style="color: #ef4444; font-size: 20px;"></i>
                                <div>
                                    <div style="font-weight: 600;">Ù…Ù„Ù PDF Ù…Ø±ÙÙ‚</div>
                                    <a href="${post.attachment}" target="_blank" style="color: #3b82f6; font-size: 12px;">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</a>
                                </div>
                            </div>
                        `;
                    } else {
                        attachmentHTML = `<img src="${post.attachment}" class="post-image" alt="Post image">`;
                    }
                }
                
                return `
                    <div class="post-item">
                        <div class="post-header">
                            <strong onclick="viewUserProfile('${post.author}')" style="cursor: pointer; color: #3b82f6;">${post.author}</strong>
                            <span>${post.timestamp}</span>
                        </div>
                        <div class="post-content">${post.content}</div>
                        ${attachmentHTML}
                    </div>
                `;
            }).join('');
            
            document.getElementById('postsToday').textContent = posts.length;
        }

        // Submit New Post
        document.getElementById('newPostForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const content = document.getElementById('postContent').value;
            const fileInput = document.getElementById('postAttachment');
            const file = fileInput.files[0];
            
            let attachmentUrl = null;
            let attachmentType = null;
            
            if (file) {
                attachmentType = file.type === 'application/pdf' ? 'pdf' : 'image';
                
                try {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('action', 'uploadFile');
                    
                    const uploadResponse = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const uploadData = await uploadResponse.json();
                    attachmentUrl = uploadData.url;
                } catch (error) {
                    console.log('File upload failed');
                }
            }
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'createPost',
                        forum: currentForum,
                        author: currentUser.name,
                        content: content,
                        attachment: attachmentUrl,
                        attachmentType: attachmentType
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('postContent').value = '';
                    document.getElementById('postAttachment').value = '';
                    loadPosts();
                    showSuccess('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­');
                }
            } catch (error) {
                document.getElementById('postContent').value = '';
                document.getElementById('postAttachment').value = '';
                loadPosts();
                showSuccess('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©)');
            }
        });

        // Chat System
        async function loadChatUsers() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getChatUsers');
                const data = await response.json();
                chatUsers = data.users || [];
            } catch (error) {
                chatUsers = [
                    { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', online: true, chatApproved: true },
                    { id: 2, name: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ', online: false, chatApproved: true },
                    { id: 3, name: 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡', online: true, chatApproved: false }
                ];
            }
            
            displayChatUsers();
        }

        function displayChatUsers() {
            const list = document.getElementById('chatUsersList');
            const approvedUsers = chatUsers.filter(u => u.chatApproved && u.id !== (currentUser.id || currentUser.username));
            
            if (approvedUsers.length === 0) {
                list.innerHTML = '<div class="loading">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…ØªØ§Ø­ÙˆÙ† Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</div>';
                return;
            }
            
            list.innerHTML = approvedUsers.map(user => `
                <div class="user-item" onclick="selectChatUser(${user.id})">
                    <div class="user-avatar">${user.name.charAt(0)}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #fff;">${user.name}</div>
                        <div style="font-size: 12px; color: ${user.online ? '#4ade80' : '#9ca3af'};">
                            <i class="fas fa-circle"></i> ${user.online ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectChatUser(userId) {
            selectedChatUser = chatUsers.find(u => u.id === userId);
            document.getElementById('selectedChatUser').innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="user-avatar" style="width: 30px; height: 30px;">${selectedChatUser.name.charAt(0)}</div>
                    <div>
                        <div style="font-weight: 600;">${selectedChatUser.name}</div>
                        <div style="font-size: 12px; color: ${selectedChatUser.online ? '#4ade80' : '#9ca3af'}">
                            ${selectedChatUser.online ? 'Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†' : 'Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±: Ù…Ù†Ø° Ù‚Ù„ÙŠÙ„'}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('messageInput').disabled = false;
            document.getElementById('sendMessageBtn').disabled = false;
            loadMessages(userId);
        }

        // Load Admin Data
        async function loadAdminData() {
            if (currentUser.type !== 'admin') return;
            
            try {
                const response = await fetch(SCRIPT_URL + '?action=getAdminData');
                const data = await response.json();
                displayAdminData(data);
            } catch (error) {
                const demoData = {
                    pendingRequests: [
                        { userId: 3, userName: 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡', requestedAt: new Date().toISOString() }
                    ],
                    allUsers: [
                        { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', type: 'student', chatApproved: true, lastSeen: new Date().toISOString() },
                        { id: 2, name: 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ', type: 'student', chatApproved: true, lastSeen: new Date(Date.now() - 3600000).toISOString() },
                        { id: 3, name: 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡', type: 'student', chatApproved: false, lastSeen: new Date().toISOString() }
                    ]
                };
                displayAdminData(demoData);
            }
        }

        function displayAdminData(data) {
            // Pending requests
            const pendingDiv = document.getElementById('pendingChatRequests');
            if (data.pendingRequests.length === 0) {
                pendingDiv.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</div>';
            } else {
                pendingDiv.innerHTML = data.pendingRequests.map(req => `
                    <div style="background: rgba(30, 41, 59, 0.6); padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600;">${req.userName}</div>
                            <div style="font-size: 12px; color: #9ca3af;">Ø·Ù„Ø¨ ÙÙŠ: ${new Date(req.requestedAt).toLocaleString('ar-SA')}</div>
                        </div>
                        <button class="btn btn-success" onclick="approveChatRequest(${req.userId})">
                            <i class="fas fa-check"></i> Ù‚Ø¨ÙˆÙ„
                        </button>
                    </div>
                `).join('');
            }

            // All users
            const allUsersDiv = document.getElementById('allUsersList');
            allUsersDiv.innerHTML = data.allUsers.map(user => `
                <div style="background: rgba(30, 41, 59, 0.6); padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600;">${user.name}</div>
                        <div style="font-size: 12px; color: #9ca3af;">
                            ${user.chatApproved ? 'Ù…ÙØ¹Ù„ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©' : 'ØºÙŠØ± Ù…ÙØ¹Ù„ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©'} | 
                            Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±: ${new Date(user.lastSeen).toLocaleString('ar-SA')}
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn ${user.chatApproved ? 'btn-danger' : 'btn-success'}" 
                                onclick="${user.chatApproved ? 'revokeChatAccess' : 'approveChatRequest'}(${user.id})">
                            <i class="fas ${user.chatApproved ? 'fa-ban' : 'fa-check'}"></i>
                            ${user.chatApproved ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function approveChatRequest(userId) {
            showSuccess(`ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userId}`);
            loadAdminData();
        }

        function revokeChatAccess(userId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
                showSuccess(`ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userId}`);
                loadAdminData();
            }
        }

        // View User Profile
        async function viewUserProfile(userId) {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getUserProfile&userId=' + userId);
                const data = await response.json();
                
                if (data.success) {
                    displayUserProfile(data.user);
                    switchView('profile');
                }
            } catch (error) {
                const demoProfile = {
                    name: userId.includes('guest') ? 'Ø²Ø§Ø¦Ø±' : userId,
                    username: userId,
                    joinDate: '2024-01-01',
                    lastSeen: new Date().toISOString(),
                    posts: 5,
                    courses: [
                        { name: 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', progress: 75 },
                        { name: 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', progress: 60 }
                    ]
                };
                displayUserProfile(demoProfile);
                switchView('profile');
            }
        }

        function displayUserProfile(user) {
            document.getElementById('profileName').textContent = user.name;
            document.getElementById('profileUsername').textContent = '@' + user.username;
            document.getElementById('profileJoinDate').textContent = user.joinDate;
            document.getElementById('profileLastSeen').textContent = new Date(user.lastSeen).toLocaleString('ar-SA');
            document.getElementById('profilePosts').textContent = user.posts || 0;
            document.getElementById('profileCourses').textContent = user.courses?.length || 0;
            document.getElementById('profileAvatar').textContent = user.name.charAt(0);
            
            const coursesList = document.getElementById('profileCoursesList');
            if (user.courses && user.courses.length > 0) {
                coursesList.innerHTML = user.courses.map(course => `
                    <div class="stat-card">
                        <h3>${course.name}</h3>
                        <div class="value">${course.progress}%</div>
                        <div class="progress-bar" style="margin-top: 10px;">
                            <div class="progress-fill" style="width: ${course.progress}%"></div>
                        </div>
                    </div>
                `).join('');
            } else {
                coursesList.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù…Ø³Ø¬Ù„Ø©</div>';
            }
        }

        // Profile Management
        function openProfileModal() {
            if (currentUser.type === 'guest') {
                showError('Ø§Ù„Ø²ÙˆØ§Ø± Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡Ù… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
                return;
            }
            openModal('profileModal');
        }

        function copyProfileLink() {
            const link = `https://myexamplewebsite.com/user/${currentUser.username}`;
            navigator.clipboard.writeText(link);
            showSuccess('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·');
        }

        function updateProfile() {
            const bio = document.getElementById('profileBio').value;
            // In a real app, send this to backend
            showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
            closeModal('profileModal');
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function openAddCourseModal() {
            if (currentUser.type === 'guest') {
                showError('Ø§Ù„Ø²ÙˆØ§Ø± Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø¯');
                return;
            }
            document.getElementById('courseProgress').addEventListener('input', function() {
                document.getElementById('progressValue').textContent = this.value + '%';
            });
            openModal('addCourseModal');
        }

        // Logout
        function logout() {
            if (guestTimer) clearInterval(guestTimer);
            currentUser = null;
            selectedChatUser = null;
            document.getElementById('authPage').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('guestTimer').classList.add('hidden');
            document.getElementById('signinForm').reset();
            document.getElementById('signupForm').reset();
            document.getElementById('guestForm').reset();
            switchTab('signin');
        }

        // Initialize
        window.addEventListener('load', () => {
            console.log('ğŸ“ ASU Student Portal Loaded');
            checkSystemStatus();
            
            // Initialize event listeners for progress bars
            document.getElementById('courseProgress')?.addEventListener('input', function() {
                document.getElementById('progressValue').textContent = this.value + '%';
            });
            
            document.getElementById('editCourseProgress')?.addEventListener('input', function() {
                document.getElementById('editProgressValue').textContent = this.value + '%';
            });
            
            // Hide subforum creation for guests
            if (currentUser?.type === 'guest') {
                document.getElementById('subforumCreateSection').classList.add('hidden');
            }
        });

        // URL Routing for profiles
        window.addEventListener('hashchange', function() {
            const hash = window.location.hash;
            if (hash.startsWith('#/user/')) {
                const username = hash.replace('#/user/', '');
                viewUserProfile(username);
            }
        });
    </script>
</body>
</html>
